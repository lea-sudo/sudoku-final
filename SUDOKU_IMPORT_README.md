# 数独导入功能说明

## 功能概述

这个数独应用现在支持从Sudoku Wiki网站导入数独题目。用户可以通过输入Sudoku Wiki的URL来导入数独题目并开始游戏。

## 使用方法

### 1. 启动应用

首先需要启动两个服务器：

```bash
# 启动主应用服务器（端口5000）
npm run dev

# 启动代理服务器（端口3001）
node server.js
```

### 2. 导入数独题目

1. 打开应用后，点击右上角的导入按钮（下载图标）
2. 在弹出的对话框中输入Sudoku Wiki的URL
3. 点击"导入"按钮
4. 导入成功后，点击"加载题目"开始游戏

## 支持的URL格式

- **Daily Sudoku**: `https://www.sudokuwiki.org/Daily_Sudoku`
- **Solver页面**: `https://www.sudokuwiki.org/Sudoku.htm`
- **其他Sudoku Wiki页面**: 任何Sudoku Wiki的页面

## 技术实现

### 代理服务器

由于浏览器的CORS限制，我们使用了一个本地代理服务器来获取外部网站的内容：

- 代理服务器运行在 `http://localhost:3001`
- 使用Express.js和axios实现
- 支持自定义User-Agent来模拟真实浏览器

### 解析逻辑

数独导入服务使用多种方法来解析网页内容：

1. **JavaScript变量解析**: 查找页面中的JavaScript变量（如`var grid = "..."`）
2. **模式匹配**: 使用正则表达式查找数独数据模式
3. **HTML表格解析**: 解析页面中的数独表格
4. **文本解析**: 从页面文本中提取数独数据

### 数据格式转换

导入的数独数据会被转换为应用内部使用的sencode格式，然后通过`startCustom`函数加载到游戏中。

## 文件结构

```
src/
├── services/
│   └── sudokuImporter.js    # 数独导入服务
├── components/
│   ├── Header/
│   │   └── Buttons.svelte   # 添加了导入按钮
│   └── Modal/
│       └── Types/
│           └── Import.svelte # 导入模态框
└── ...
server.js                     # 代理服务器
```

## 注意事项

1. 确保代理服务器正在运行，否则导入功能无法工作
2. 某些Sudoku Wiki页面可能需要特定的解析逻辑
3. 如果导入失败，会显示相应的错误信息
4. 导入功能依赖于Sudoku Wiki的页面结构，如果网站结构发生变化，可能需要更新解析逻辑

## 故障排除

### 常见问题

1. **"无法通过本地代理获取页面内容"**
   - 检查代理服务器是否正在运行
   - 确认端口3001没有被其他程序占用

2. **"无法解析数独数据"**
   - 检查URL是否正确
   - 确认Sudoku Wiki网站可以正常访问
   - 可能需要更新解析逻辑

3. **"代理服务器返回错误"**
   - 检查网络连接
   - 确认目标网站可以访问
   - 查看代理服务器日志

### 调试

可以在浏览器控制台中查看详细的导入过程日志，包括：
- URL验证结果
- 代理请求状态
- 解析方法尝试过程
- 最终结果

## 扩展功能

未来可以考虑添加的功能：

1. 支持更多数独网站
2. 批量导入功能
3. 导入历史记录
4. 自动检测数独难度
5. 支持更多数据格式 